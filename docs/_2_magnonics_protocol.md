markdown name=docs/magnonics_protocol.md
# Magnonics / Oscillator Domain Protocol (Phase 2 Scaffold)

Objective: Determine whether the LUFT candidate base resonance (f0 ≈ 7468.779 Hz) or its lattice emerges in a controlled magnonic / oscillator system without deliberate amplitude modulation at that frequency.

---

## 1. System Types
A) Ferrite / YIG element with DC bias coil + pickup coil  
B) Driven microwave FMR (GHz) with LF envelope readout  
C) Precision low-frequency oscillator (quartz / LC) for cross-comparison

---

## 2. Data Structure
Directory: data/raw/magnonics/<run_id>/
- trace_<sensor_name>.npy : float32 or float64 time-series
- meta.json:
  {
    "fs": 96000,
    "sensors": ["pickup", "reference"],
    "bias_mT": 120.0,
    "temperature_C": 25.4,
    "drive_freq_Hz": 3150000000.0,
    "notes": "...",
    "clock_ref": "GPSDO_10MHz",
    "start_utc": "2025-08-13T19:10:00Z"
  }

Optional sidecar per sensor: trace_<sensor>_sidecar.json for additional calibration (gain, coil turns).

---

## 3. Acquisition Plan (Minimal Viable Pass)
1. Warm-up ≥30 min with disciplined clock.
2. Bias sweep 0 → target mT values in steps (e.g., 10–20 mT).
3. At each bias: record 3 × 5 min segments.
4. Decoy block after each bias set:
   - Time-scramble test
   - Dummy load on pickup channel
5. De-discipline trial (free-running oscillator or disabled GPSDO).

---

## 4. Analysis Outputs
Generated by pipeline_magnonics:
- magnonics_peaks.csv : PSD peaks near f0
- magnonics_sidebands.csv : sidebands around drive (f_drive ± nΔ)
- magnonics_phase.csv : phase/coherence stats (if multi-sensor)
- magnonics_summary.md : run summary

---

## 5. Sideband Detection
Given drive frequency f_drive:
- Search (f0, if independent)
- Search sidebands f_drive ± n * Δf_sb (Δf_sb configurable, default 2 Hz) if inside Nyquist after downconversion/envelope.
- Compute amplitude, z-score vs local robust baseline (median/MAD).

---

## 6. Significance & Null
- PSD: Welch with 8 s Hann, 50% overlap
- Z-score via local window (±150 Hz excluding ±3 Hz of candidate)
- FDR (Benjamini–Hochberg) across tested bins
- Optional empirical permutation:
  - Block shuffle (phase.decoy_block_len) N times
  - Build distribution of max z near target
  - Empirical p-value

---

## 7. Phase Metrics
If ≥2 sensors:
- Narrowband extraction at f0
- Compute PLV, mean phase, drift
- Permutation p (time-scramble)
- Report pass/fail w.r.t thresholds in config.phase

---

## 8. Acceptance Criteria (Draft)
A bias setting ‘hit’ if:
1. Peak at f0 within tolerance_hz with z ≥ z_min (e.g., 6) and q < 0.05
2. Absent (z < 3 or q > 0.2) in decoys
3. If multi-sensor: PLV ≥ 0.6 and p ≤ 0.05

---

## 9. Escalation (Later)
- Field dependence modeling (fit dispersion of magnon mode vs H)
- Cross-run stability metrics (meta-analysis)
- Multi-frequency lattice fit (harmonic enrichment p-value)

---

## 10. Preregistration
Document fixed parameters (window length, z thresholds, Δf sideband spacing, number of permutations) in prereg file before large-scale data collection.

*Version 0.1*
